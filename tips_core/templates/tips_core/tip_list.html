{% extends 'base.html' %}
{% load static %}

{% block title %}Tips e Análises do Dia{% endblock %}

{% block content %}
    
    {# NOVO CONTAINER CENTRALIZADO PARA O HERO SECTION (BANNER/CARROSSEL/BOTÕES) #}
    <div class="container"> 
        
        {# HERO SECTION: CONTEÚDO PRINCIPAL DE DESTAQUE #}
        <div class="row mb-5 pt-0">
            <div class="col-12 text-center p-0"> 
                
                {# CONDICIONAL: SE O USUÁRIO NÃO ESTÁ LOGADO, MOSTRAR CARROSSEL #}
                {% if not user.is_authenticated %}
                    {% if promo_banners %}
                        <div class="row justify-content-center pt-2 pb-2">
                            <div class="col-12 px-0"> 
                                <div id="promoCarousel" class="carousel slide promo-carousel-container" data-bs-ride="carousel" data-bs-interval="5000">
                                    <div class="carousel-inner h-100"> 
                                        {% for banner in promo_banners %}
                                            <div class="carousel-item h-100 {% if forloop.first %}active{% endif %}">
                                                <a href="{{ banner.link_url }}" target="_blank" class="d-block h-100">
                                                    {# CORREÇÃO AQUI: USA O CAMPO ORIGINAL DO UPLOAD #}
                                                    <img src="{{ banner.imagem.url }}" alt="{{ banner.titulo }}">
                                                    <div class="carousel-caption d-none d-md-block text-start p-2 rounded">
                                                        {% if banner.titulo %}
                                                            <h5>{{ banner.titulo }}</h5>
                                                        {% endif %}
                                                        {% if banner.descricao %}<p>{{ banner.descricao }}</p>{% endif %}
                                                    </div>
                                                </a>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    {% if promo_banners|length > 1 %}
                                        <button class="carousel-control-prev" type="button" data-bs-target="#promoCarousel" data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Anterior</span>
                                        </button>
                                        <button class="carousel-control-next" type="button" data-bs-target="#promoCarousel" data-bs-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Próximo</span>
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% else %}
                        {# Fallback se não houver banners #}
                        <h1 class="display-5 fw-bold text-light mt-4">Nenhuma promoção ativa no momento.</h1>
                        <p class="lead text-light mt-3">Cadastre-se para ver as melhores tips!</p>
                    {% endif %}
                {% else %}
                    {# Usuário logado #}
                    <h1 class="display-5 fw-bold text-light mt-4">Bem-vindo(a) de volta!</h1>
                    <p class="lead text-light mt-3">Acompanhe suas Tips e Análises Exclusivas!</p>
                {% endif %}
                
                {# Botões de Cadastro/Ver Premium #}
                {% if not user.is_authenticated %}
                    <a href="{% url 'register' %}" class="btn btn-warning btn-lg mt-3 fw-bold text-dark me-3">
                        Cadastre-se Grátis Agora! <i class="fa fa-arrow-right"></i>
                    </a>
                {% else %}
                    <a href="{% url 'premium_link' %}" class="btn btn-warning btn-lg mt-3 fw-bold text-dark me-3">
                        Ver Tips Premium <i class="fa fa-crown"></i>
                    </a>
                {% endif %}
            </div>
        </div>
        {# FIM HERO SECTION #}
        
        <hr class="my-5"> 
    </div>
    {# FIM DO NOVO CONTAINER CENTRALIZADO #}


    {# --- SEÇÃO DE TIPS/JOGOS - FORA DO CONTAINER PARA OCUPAR TODA A LARGURA --- #}
    
    {% if user.is_authenticated %}
        
        {# ----------------------------------------------------------- #}
        {# --- SEÇÃO 1: JOGOS DE HOJE --- #}
        {# ----------------------------------------------------------- #}
        <div class="container"> {# Adicionado container aqui para alinhar as tips #}
            {% if tips_categorias.hoje %}
                <h2 class="mb-4 text-light"><i class="fas fa-calendar-check me-2 text-warning"></i> Jogos de Hoje</h2>
                <div class="row">
                    {% for tip in tips_categorias.hoje %}
                        {% include "tips_core/includes/tip_card.html" with tip=tip %}
                    {% endfor %}
                </div>
                <hr class="my-5">
            {% endif %}
        </div>
        
        {# ----------------------------------------------------------- #}
        {# --- SEÇÃO 2: PRÓXIMOS JOGOS (FUTURO) --- #}
        {# ----------------------------------------------------------- #}
        <div class="container"> {# Adicionado container aqui para alinhar as tips #}
            {% if tips_categorias.proximos %}
                <h2 class="mb-4 text-light"><i class="fas fa-forward me-2 text-info"></i> Próximos Jogos</h2>
                <div class="row">
                    {% for tip in tips_categorias.proximos %}
                        {% include "tips_core/includes/tip_card.html" with tip=tip %}
                    {% endfor %}
                </div>
                <hr class="my-5">
            {% endif %}
        </div>
        
        {# ----------------------------------------------------------- #}
        {# --- SEÇÃO 3: JOGOS PASSADOS (CONCLUÍDOS) --- #}
        {# ----------------------------------------------------------- #}
        <div class="container"> {# Adicionado container aqui para alinhar as tips #}
            {% if tips_categorias.concluidos %}
                <h2 class="mb-4 text-light"><i class="fas fa-history me-2 text-secondary"></i> Jogos Passados (Concluídos)</h2>
                <div class="row">
                    {% for tip in tips_categorias.concluidos %}
                        {% include "tips_core/includes/tip_card.html" with tip=tip %}
                    {% endfor %}
                </div>
                <hr class="my-5">
            {% endif %}
        </div>

        {# ----------------------------------------------------------- #}
        {# --- SEÇÃO 4: JOGOS PASSADOS (RESULTADO PENDENTE/ERRO) --- #}
        {# ----------------------------------------------------------- #}
        <div class="container"> {# Adicionado container aqui para alinhar as tips #}
            {% if tips_categorias.passados %}
                <h2 class="mb-4 text-light"><i class="fas fa-exclamation-triangle me-2 text-danger"></i> Jogos Passados (Resultado Pendente)</h2>
                <div class="row">
                    {% for tip in tips_categorias.passados %}
                        {% include "tips_core/includes/tip_card.html" with tip=tip %}
                    {% endfor %}
                </div>
                <hr class="my-5">
            {% endif %}
        </div>
        
    {% endif %}
    {# FIM DO BLOCO CONDICIONAL DAS TIPS GRATUITAS #}


    {# --- INÍCIO: BLOCO DE JOGOS DO AISCORE (LARGURA TOTAL) --- #}
    {% if not user.is_authenticated %}
        <div class="row mb-5"> 
            {# Título da seção dentro do container para alinhamento #}
            <div class="container">
                <h2 class="col-12 text-light fw-bold mb-4 border-bottom pb-2 text-start px-0">Jogos e Placar ao Vivo</h2>
            </div>
            
            {# Este bloco col-12 px-0 é o que vai esticar para as bordas #}
            <div class="col-12 px-0"> 
                <div id="aiscore-free"></div>
                
                <script language="javascript">
                    document.getElementById("aiscore-free").innerHTML="<iframe src='https://www.aiscore.com/br?width=1200&theme=blue' height='800' width='100%' scrolling='auto' border='0' frameborder='0'></iframe>";
                </script>
                
                <style>
                    /* Estilos para o contêiner do widget */
                    #aiscore-free{
                        display:flex;
                        justify-content:center;
                        height: 800px; 
                    }
                    body{margin:0} 
                </style>

            </div>
        </div>
        <hr class="my-5">
    {% endif %}
    {# --- FIM: BLOCO DE JOGOS DO AISCORE --- #}


    <div class="container"> {# Retorna o container para o rodapé/botão premium #}
        <div class="text-center p-3 hero-section-card rounded">
            <h3 class="fw-bold text-light">Aumente seus Ganhos com o Premium</h3>
            <p class="lead text-light">Acesso a tips exclusivas e análises aprofundadas que não estão disponíveis publicamente.</p>
            
            {% if user.is_premium_member %}
                <a href="{% url 'premium_tips_content' %}" class="btn btn-primary btn-lg mt-3">
                    Ver Conteúdo Premium <i class="fa fa-lock-open"></i>
                </a>
            {% else %}
                <form method="post" action="{% url 'choose_plan' %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-warning btn-lg mt-3 fw-bold text-dark">
                        Assinar Premium Agora! <i class="fa fa-crown"></i>
                    </button>
                </form>
            {% endif %}
        </div>
    </div>

{% endblock content %}