{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-5 pt-4">
    <h1 class="text-light fw-bold mb-4 border-bottom pb-2">{{ title }}</h1>
    
    {# Exibe mensagens de erro ou sucesso do Django #}
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    {% endif %}

    <div class="row">
        {% if tips %}
            {% for tip in tips %}
                <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    {# Card com destaque Premium #}
                    <div class="tip-card p-3 shadow-lg 
                        {% if tip.status == 'WIN' %}win{% elif tip.status == 'LOSS' %}loss{% else %}pending{% endif %}">
                        
                        {# CABEÇALHO PREMIUM #}
                        <h5 class="fw-bold text-warning mb-2">
                            <i class="fas fa-crown me-2"></i> Tip Premium
                        </h5>
                        <hr class="my-2">
                        
                        {# TÍTULO COM DESTAQUE AMARELO (NOMES DOS TIMES) #}
                        <h6 class="fw-bold mb-1 text-warning">
                            {{ tip.home_team.name }} <span class="text-light">x</span> {{ tip.away_team.name }} 
                        </h6>
                        <span class="small text-light">{{ tip.league }}</span>
                        <hr class="my-1">
                        
                        {# DETALHES PRINCIPAIS #}
                        <p class="small text-light mb-1">
                            <i class="fa fa-calendar-alt me-2 text-info"></i> 
                            Data: {{ tip.match_date|date:"d/m/Y H:i" }}
                        </p>
                        
                        <p class="text-light mb-1">
                            <i class="fa fa-bullseye me-2 text-success"></i> 
                            <strong>Método:</strong> {{ tip.get_method_display }}
                        </p>

                        <p class="text-light mb-2">
                            <strong>Odd:</strong> 
                            <span class="odd-badge">{{ tip.odd_value }}</span>
                            Status: <span class="fw-bold">{{ tip.get_status_display }}</span>
                        </p>
                        
                        {# PLACAR FINAL (ATUALIZADO PARA CAMPOS NUMÉRICOS) #}
                        {% if tip.score_home is not None and tip.score_away is not None %}
                        <p class="small text-light mb-1">
                            <i class="fa fa-trophy me-2 text-warning"></i> 
                            <strong>Placar Final:</strong> {{ tip.score_home }} - {{ tip.score_away }}
                        </p>
                        {% endif %}

                        {# NOVO BLOCO DE OBSERVAÇÃO #}
{% if tip.observation %}
    <div class="mt-2 p-2 rounded" style="background-color: rgba(255, 255, 255, 0.05); border-left: 3px solid #ffc107;">
        <p class="small text-light mb-0" style="font-style: italic;">
            <i class="fas fa-comment-dots me-1 text-warning"></i> {{ tip.observation }}
        </p>
    </div>
{% endif %}

                        {# FINANCEIROS #}
                        <p class="small text-light mb-1">
                            <i class="fa fa-coins me-2 text-info"></i> 
                            <strong>Aposta:</strong> R$ {{ tip.valor_aposta|floatformat:2 }}
                        </p>
                        {% if tip.valor_ganho %}
                        <p class="small text-light mb-1">
                            <i class="fa fa-arrow-up me-2 text-success"></i> 
                            <strong>Ganho:</strong> R$ {{ tip.valor_ganho|floatformat:2 }}
                        </p>
                        {% endif %}
                        {% if tip.valor_perda %}
                        <p class="small text-light mb-2">
                            <i class="fa fa-arrow-down me-2 text-danger"></i> 
                            <strong>Perda:</strong> R$ {{ tip.valor_perda|floatformat:2 }}
                        </p>
                        {% endif %}
                        
                        {# BOTÃO DE OCULTAR (ADMIN) #}
                        {% if user.is_superuser %}
                            <form method="post" action="{% url 'deactivate_tip' tip_id=tip.id %}" style="display: inline;" class="mb-2">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn-sm w-100">
                                    Ocultar Aposta (Admin) <i class="fa fa-eye-slash"></i>
                                </button>
                            </form>
                        {% endif %}

                        {# Botão de Aposta (Link Direto) #}
                        {% if tip.link_aposta %}
                            <a href="{{ tip.link_aposta }}" target="_blank" class="btn btn-success btn-sm w-100 mt-auto">
                                Apostar com Confiança <i class="fa fa-external-link-alt"></i>
                            </a>
                        {% endif %}

                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="alert alert-info" role="alert">
                Nenhuma Tip Premium ativa no momento. Aguarde as novas análises!
            </div>
        {% endif %}
    </div>
</div>
{% endblock content %}